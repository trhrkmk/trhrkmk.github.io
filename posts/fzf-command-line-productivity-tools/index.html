<!doctype html><html><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.83.1"><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/reseter.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@exampledev/new.css@1.1.3/new.min.css><link rel=stylesheet href=https://www.trhrkmk.com/css/syntax.css><link rel=stylesheet href=https://www.trhrkmk.com/css/custom.css><title>fzfを使ってターミナルでの作業を効率化する | trhrkmk.com</title><link rel=canonical href=https://www.trhrkmk.com/posts/fzf-command-line-productivity-tools/><meta name=description content="  "><body><div id=wrapper><header><div class=head__inner><h1><a href=https://www.trhrkmk.com>trhrkmk.com</a></h1></div></header><div id=content><main><section class=entry><h2>fzfを使ってターミナルでの作業を効率化する</h2><p>タイトルの通りですが、自分なりにfzfを使ってターミナルでの作業を効率化できたので、メモ。</p><p>すごく快適になるので、試してみてほしいです！</p><h2 id=fzfを使うとどのように効率化できるのか>fzfを使うと、どのように効率化できるのか？</h2><p>ターミナル内でのディレクトリの移動が快適にできるようになります。</p><p>以下のgifにもある通り、ghqを使うことでリポジトリの移動が快適になります。</p><p>どちらかといえば、pecoのほうが人気な気がしますが、Vimとの連携もできるので、Vimを使っている方にもおすすめです。</p><h3 id=シンプルにfzfコマンドを実行する>シンプルにfzfコマンドを実行する</h3><p>まずは、シンプルにfzfを実行する。</p><p><img src=./fzf-command-line-tools-1.gif alt=fzf title=fzf></p><p>ちなみに、私は以下のデフォルトオプションを設定しています。</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>export</span> <span class=nv>FZF_DEFAULT_OPTS</span><span class=o>=</span><span class=s2>&#34;--height 50% --layout=reverse --border --inline-info --preview &#39;head -100 {}&#39;&#34;</span>
</code></pre></div><h3 id=ghqとfzfを連携する>ghqとfzfを連携する</h3><p>ghqとfzfを連携して、リポジトリの移動をする。</p><p><img src=./fzf-command-line-tools-2.gif alt=fzf title=fzf></p><h2 id=各種リンク>各種リンク</h2><ul><li><a href=https://github.com/junegunn/fzf>https://github.com/junegunn/fzf</a></li><li><a href=https://github.com/motemen/ghq>https://github.com/motemen/ghq</a></li><li><a href=https://github.com/peco/peco>https://github.com/peco/peco</a></li></ul><h2 id=インストール>インストール</h2><p>GitHubを見るのが良いと思いますが…</p><p>一応ね…</p><p>macの場合、brewでインストールできます。</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>brew install fzf
</code></pre></div><p>Ubuntuでは、リリースからバイナリをダウンロードして、パスを通して使っています。</p><h2 id=まずは使ってみる>まずは、使ってみる</h2><p>gifにもあったように、<code>fzf</code>を実行してファイルを選択すると、該当のファイル名を受け取れます。</p><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>~/go/src/github.com/google/skicka <span class=o>[</span><span class=nv>master</span><span class=o>=]</span> $ fzf
README.md
</code></pre></div><p>GitHubの引用ですが、以下のような感じで利用できます。</p><h3 id=フォルダを選択する>フォルダを選択する</h3><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>find * -type d <span class=p>|</span> fzf
</code></pre></div><p><img src=./fzf-command-line-tools-3.gif alt=fzf title=fzf></p><h3 id=vimで開く>Vimで開く</h3><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>vim <span class=k>$(</span>fzf<span class=k>)</span>
</code></pre></div><p><img src=./fzf-command-line-tools-4.gif alt=fzf title=fzf></p><h3 id=--heightオプションをつけて実行する>&ndash;heightオプションをつけて実行する</h3><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>vim <span class=k>$(</span>fzf --height 40%<span class=k>)</span>
</code></pre></div><p><img src=./fzf-command-line-tools-5.gif alt=fzf title=fzf></p><h3 id=--reverseオプションをつけて実行する>&ndash;reverseオプションをつけて実行する</h3><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>vim <span class=k>$(</span>fzf --height 40% --reverse<span class=k>)</span>
</code></pre></div><p><img src=./fzf-command-line-tools-6.gif alt=fzf title=fzf></p><h2 id=デフォルトのオプションを設定する>デフォルトのオプションを設定する</h2><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash>vim <span class=k>$(</span>fzf --height 40% --reverse<span class=k>)</span>
<span class=nb>export</span> <span class=nv>FZF_DEFAULT_OPTS</span><span class=o>=</span><span class=s1>&#39;--height 40% --layout=reverse --border&#39;</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=nb>export</span> <span class=nv>FZF_DEFAULT_COMMAND</span><span class=o>=</span><span class=s1>&#39;fd --type f&#39;</span>
</code></pre></div><h2 id=wikiをみる>Wikiをみる</h2><p>やりたいことは、Wikiを見れば分かると思います。</p><ul><li><a href=https://github.com/junegunn/fzf/wiki>https://github.com/junegunn/fzf/wiki</a></li></ul><h3 id=ghqとの連携で使っている関数>ghqとの連携で使っている関数</h3><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># fdg - ghq</span>
fdg<span class=o>()</span> <span class=o>{</span>
  <span class=nb>local</span> selected
  <span class=nv>selected</span><span class=o>=</span><span class=k>$(</span>ghq list <span class=p>|</span> fzf<span class=k>)</span>

  <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$selected</span><span class=s2>&#34;</span> !<span class=o>=</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
    <span class=nb>cd</span> <span class=k>$(</span>ghq root<span class=k>)</span>/<span class=nv>$selected</span>
  <span class=k>fi</span>
<span class=o>}</span>
</code></pre></div><h3 id=wikiから引用して私が使っている関数など>Wikiから引用して、私が使っている関数など</h3><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># fh - repeat history</span>
fh<span class=o>()</span> <span class=o>{</span>
  <span class=nb>eval</span> <span class=k>$(</span> <span class=o>([</span> -n <span class=s2>&#34;</span><span class=nv>$ZSH_NAME</span><span class=s2>&#34;</span> <span class=o>]</span> <span class=o>&amp;&amp;</span> <span class=nb>fc</span> -l <span class=m>1</span> <span class=o>||</span> <span class=nb>history</span><span class=k>)</span> <span class=p>|</span> fzf +s --tac <span class=p>|</span> sed <span class=s1>&#39;s/ *[0-9]* *//&#39;</span><span class=o>)</span>
<span class=o>}</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># fkill - kill process</span>
fkill<span class=o>()</span> <span class=o>{</span>
  <span class=nb>local</span> pid
  <span class=nv>pid</span><span class=o>=</span><span class=k>$(</span>ps -ef <span class=p>|</span> sed 1d <span class=p>|</span> fzf -m <span class=p>|</span> awk <span class=s1>&#39;{print $2}&#39;</span><span class=k>)</span>

  <span class=k>if</span> <span class=o>[</span> <span class=s2>&#34;x</span><span class=nv>$pid</span><span class=s2>&#34;</span> !<span class=o>=</span> <span class=s2>&#34;x&#34;</span> <span class=o>]</span>
  <span class=k>then</span>
    <span class=nb>echo</span> <span class=nv>$pid</span> <span class=p>|</span> xargs <span class=nb>kill</span> -<span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=nv>9</span><span class=si>}</span>
  <span class=k>fi</span>
<span class=o>}</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># fd - cd to selected directory</span>
fd<span class=o>()</span> <span class=o>{</span>
  <span class=nb>local</span> dir
  <span class=nv>dir</span><span class=o>=</span><span class=k>$(</span>find <span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=p>.</span><span class=si>}</span> -path <span class=s1>&#39;*/\.*&#39;</span> -prune <span class=se>\
</span><span class=se></span>                  -o -type d -print 2&gt; /dev/null <span class=p>|</span> fzf +m<span class=k>)</span> <span class=o>&amp;&amp;</span>
  <span class=nb>cd</span> <span class=s2>&#34;</span><span class=nv>$dir</span><span class=s2>&#34;</span>
<span class=o>}</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># fda - including hidden directories</span>
fda<span class=o>()</span> <span class=o>{</span>
  <span class=nb>local</span> dir
  <span class=nv>dir</span><span class=o>=</span><span class=k>$(</span>find <span class=si>${</span><span class=nv>1</span><span class=k>:-</span><span class=p>.</span><span class=si>}</span> -type d 2&gt; /dev/null <span class=p>|</span> fzf +m<span class=k>)</span> <span class=o>&amp;&amp;</span> <span class=nb>cd</span> <span class=s2>&#34;</span><span class=nv>$dir</span><span class=s2>&#34;</span>
<span class=o>}</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># fshow - git commit browser</span>
fshow<span class=o>()</span> <span class=o>{</span>
  git log --graph --color<span class=o>=</span>always <span class=se>\
</span><span class=se></span>      --format<span class=o>=</span><span class=s2>&#34;%C(auto)%h%d %s %C(black)%C(bold)%cr&#34;</span> <span class=s2>&#34;</span><span class=nv>$@</span><span class=s2>&#34;</span> <span class=p>|</span>
  fzf --ansi --no-sort --reverse --tiebreak<span class=o>=</span>index --bind<span class=o>=</span>ctrl-s:toggle-sort <span class=se>\
</span><span class=se></span>      --bind <span class=s2>&#34;ctrl-m:execute:
</span><span class=s2>                (grep -o &#39;[a-f0-9]\{7\}&#39; | head -1 |
</span><span class=s2>                xargs -I % sh -c &#39;git show --color=always % | less -R&#39;) &lt;&lt; &#39;FZF-EOF&#39;
</span><span class=s2>                {}
</span><span class=s2>FZF-EOF&#34;</span>
<span class=o>}</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-bash data-lang=bash><span class=c1># tm - create new tmux session, or switch to existing one. Works from within tmux too. (@bag-man)</span>
<span class=c1># `tm` will allow you to select your tmux session via fzf.</span>
<span class=c1># `tm irc` will attach to the irc session (if it exists), else it will create it.</span>

tm<span class=o>()</span> <span class=o>{</span>
  <span class=o>[[</span> -n <span class=s2>&#34;</span><span class=nv>$TMUX</span><span class=s2>&#34;</span> <span class=o>]]</span> <span class=o>&amp;&amp;</span> <span class=nv>change</span><span class=o>=</span><span class=s2>&#34;switch-client&#34;</span> <span class=o>||</span> <span class=nv>change</span><span class=o>=</span><span class=s2>&#34;attach-session&#34;</span>
  <span class=k>if</span> <span class=o>[</span> <span class=nv>$1</span> <span class=o>]</span><span class=p>;</span> <span class=k>then</span>
    tmux <span class=nv>$change</span> -t <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span> 2&gt;/dev/null <span class=o>||</span> <span class=o>(</span>tmux new-session -d -s <span class=nv>$1</span> <span class=o>&amp;&amp;</span> tmux <span class=nv>$change</span> -t <span class=s2>&#34;</span><span class=nv>$1</span><span class=s2>&#34;</span><span class=o>)</span><span class=p>;</span> <span class=k>return</span>
  <span class=k>fi</span>
  <span class=nv>session</span><span class=o>=</span><span class=k>$(</span>tmux list-sessions -F <span class=s2>&#34;#{session_name}&#34;</span> 2&gt;/dev/null <span class=p>|</span> fzf --exit-0<span class=k>)</span> <span class=o>&amp;&amp;</span>  tmux <span class=nv>$change</span> -t <span class=s2>&#34;</span><span class=nv>$session</span><span class=s2>&#34;</span> <span class=o>||</span> <span class=nb>echo</span> <span class=s2>&#34;No sessions found.&#34;</span>
<span class=o>}</span>
</code></pre></div><h2 id=あとがき>あとがき</h2><p>pecoもfzfもGo製ってのがいいですね！</p></section></main></div><footer><div class=foot__inner><p class=copyright>Copyright © 2019-2021 Teruhiro Komaki <a href=https://twitter.com/trhrkmk>@trhrkmk</a></p></div></footer></div></body></html>